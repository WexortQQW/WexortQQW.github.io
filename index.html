<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Форма заказа запчастей</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="card">
    <h2>Форма заказа запчастей</h2>
    <form id="orderForm" method="POST" target="hidden_iframe" action="https://script.google.com/macros/s/AKfycbztEHXqCD2r0GOHgZATTToKijfr8tkUD8sS6tf6Y7tT9QSjjzbrl3okP0Iff_-raqvWBw/exec">
      <label>ФИО *
        <input type="text" name="name" required>
      </label>
      <label>Телефон *
        <input type="tel" name="phone" required>
      </label>
      <label>Email
        <input type="email" name="email">
      </label>
      <label>VIN *
        <input type="text" name="vin" required>
      </label>
      <label>Модель
        <input type="text" name="model">
      </label>
      <label>Год выпуска
        <input type="number" name="year">
      </label>
      <label>Название детали *
        <input type="text" name="partName" required>
      </label>
      <label>Артикул
        <input type="text" name="article">
      </label>
      <label>Количество *
        <input type="number" name="qty" required value="1">
      </label>
      <label>Комментарий
        <textarea name="comment"></textarea>
      </label>

      <!-- Скрытые поля -->
      <input type="hidden" name="orderId" id="orderId">
      <input type="hidden" name="personalId" id="personalId">

      <button type="submit">Отправить заказ</button>
    </form>

    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>
  </div>

  <!-- Модальное окно -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <h3 id="modalTitle"></h3>
      <p id="modalMsg"></p>
      <p><b>Order ID:</b> <span id="orderIdDisplay">—</span></p>
      <p><b>Personal ID:</b> <span id="personalIdDisplay">—</span></p>
      <button onclick="copyBoth()">Копировать оба</button>
      <button onclick="closeModal()">Закрыть</button>
    </div>
  </div>

  <script>
    const form = document.getElementById("orderForm");
    const iframe = document.getElementById("hidden_iframe");

    form.addEventListener("submit", () => {
      // Генерация ID
      const orderId = Date.now(); // уникальный номер
      const phone = form.querySelector("[name='phone']").value;
      const personalId = phone.slice(-4); // последние 4 цифры

      document.getElementById("orderId").value = orderId;
      document.getElementById("personalId").value = personalId;

      // Отобразим их потом в модалке
      form.dataset.orderId = orderId;
      form.dataset.personalId = personalId;
    });

    iframe.onload = function () {
      showModal(
        "Заявка принята",
        "Спасибо, ваша заявка отправлена. Проверьте таблицу/почту."
      );
    };

    function showModal(title, msg) {
      document.getElementById("modalTitle").textContent = title;
      document.getElementById("modalMsg").textContent = msg;

      document.getElementById("orderIdDisplay").textContent = form.dataset.orderId || "—";
      document.getElementById("personalIdDisplay").textContent = form.dataset.personalId || "—";

      document.getElementById("modal").style.display = "flex";
    }

    function closeModal() {
      document.getElementById("modal").style.display = "none";
      form.reset();
    }

    function copyBoth() {
      const text = `Order ID: ${form.dataset.orderId}, Personal ID: ${form.dataset.personalId}`;
      navigator.clipboard.writeText(text).then(() => {
        alert("Скопировано: " + text);
      });
    }
  </script>
</body>
</html>
