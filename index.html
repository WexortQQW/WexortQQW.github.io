<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Заказ авто деталей</title>
    <style>
        /* Ваши стили остаются без изменений */
    </style>
</head>
<body>
    <div class="container">
        <!-- Ваша HTML-разметка остается без изменений -->
    </div>

    <script>
        // Функция для отправки данных через создание скрытой формы
        function submitToGoogleAppsScript(formData) {
            return new Promise((resolve, reject) => {
                // Замените на ваш URL Google Apps Script
                const scriptUrl = 'https://script.google.com/macros/s/AKfycbzCnsB_sFpBVyUW6R-JN320ysbwfJXZur9OZlxLW6107gtz6_wuoBF8h1-DG3PC9_ftoQ/exec';
                
                // Создаем скрытую форму
                const hiddenForm = document.createElement('form');
                hiddenForm.method = 'POST';
                hiddenForm.action = scriptUrl;
                hiddenForm.target = 'hiddenFrame';
                hiddenForm.style.display = 'none';
                
                // Добавляем поля в форму
                const fields = [
                    { name: 'name', value: formData.name },
                    { name: 'phone', value: formData.phone },
                    { name: 'email', value: formData.email },
                    { name: 'carBrand', value: formData.carBrand },
                    { name: 'carModel', value: formData.carModel },
                    { name: 'year', value: formData.year },
                    { name: 'partName', value: formData.partName },
                    { name: 'partNumber', value: formData.partNumber },
                    { name: 'quantity', value: formData.quantity },
                    { name: 'comments', value: formData.comments },
                    { name: 'timestamp', value: new Date().toLocaleString('ru-RU') }
                ];
                
                fields.forEach(field => {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = field.name;
                    input.value = field.value || '';
                    hiddenForm.appendChild(input);
                });
                
                // Создаем скрытый iframe для обработки ответа
                const hiddenFrame = document.createElement('iframe');
                hiddenFrame.name = 'hiddenFrame';
                hiddenFrame.style.display = 'none';
                
                // Добавляем обработчик загрузки iframe
                hiddenFrame.onload = () => {
                    // Предполагаем, что отправка прошла успешно
                    resolve();
                    document.body.removeChild(hiddenForm);
                    document.body.removeChild(hiddenFrame);
                };
                
                hiddenFrame.onerror = () => {
                    reject(new Error('Ошибка отправки формы'));
                    document.body.removeChild(hiddenForm);
                    document.body.removeChild(hiddenFrame);
                };
                
                // ВАЖНО: Сначала добавляем форму и iframe в DOM
                document.body.appendChild(hiddenForm);
                document.body.appendChild(hiddenFrame);
                
                // Теперь можно отправлять форму
                hiddenForm.submit();
            });
        }
        
        // Обработчик отправки формы
        document.getElementById('orderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Показать индикатор загрузки
            document.getElementById('loading').style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            
            // Собрать данные формы
            const formData = {
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value.replace(/\D/g, ''),
                email: document.getElementById('email').value,
                carBrand: document.getElementById('carBrand').value,
                carModel: document.getElementById('carModel').value,
                year: document.getElementById('year').value,
                partName: document.getElementById('partName').value,
                partNumber: document.getElementById('partNumber').value,
                quantity: document.getElementById('quantity').value,
                comments: document.getElementById('comments').value
            };
            
            try {
                // Отправляем данные через Google Apps Script
                await submitToGoogleAppsScript(formData);
                
                // Показать сообщение об успехе
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('orderForm').reset();
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('errorMessage').style.display = 'block';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        });
        
        // Добавляем маску для телефона
        document.getElementById('phone').addEventListener('input', function(e) {
            const value = e.target.value.replace(/\D/g, '');
            let formattedValue = '';
            
            if (value.length > 0) {
                formattedValue = '+7 (' + value.substring(1, 4);
            }
            if (value.length >= 4) {
                formattedValue += ') ' + value.substring(4, 7);
            }
            if (value.length >= 7) {
                formattedValue += '-' + value.substring(7, 9);
            }
            if (value.length >= 9) {
                formattedValue += '-' + value.substring(9, 11);
            }
            
            e.target.value = formattedValue;
        });
    </script>
</body>
</html>
